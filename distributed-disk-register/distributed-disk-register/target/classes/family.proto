syntax = "proto3";

package family;

option java_multiple_files = true;
option java_package = "family";
option java_outer_classname = "FamilyProto";

message NodeInfo {  //üye kimliği
  string host = 1;
  int32 port = 2;
}

message FamilyView {
  repeated NodeInfo members = 1;
}

message Empty {}

message ChatMessage {
  string text = 1;
  string fromHost = 2;
  int32 fromPort = 3;
  int64 timestamp = 4;
}

// Set karşılığı
message StoredMessage {
  int32 id = 1;
  string text = 2;
  bool found = 3; // GET sorgusunda bulunup bulunmadığını anlamak için
}

// Store işleminin sonucu
message StoreResult {
  bool success = 1;
  string message = 2;
}

// GET işlemi
message MessageId {
  int32 id = 1;
}

// --- SERVİS TANIMLARI ---
service FamilyService {
  // üye yönetim fonks
  rpc Join (NodeInfo) returns (FamilyView);
  rpc GetFamily (Empty) returns (FamilyView);
  rpc GetCount (Empty) returns (CountResponse);
  rpc ReceiveChat (ChatMessage) returns (Empty);
  // depolama fonks
  //set için
  rpc Store (StoredMessage) returns (StoreResult); //mesajı diske kaydeder
  //get için
  rpc Retrieve (MessageId) returns (StoredMessage); //mesajı diskten alır
}
message CountResponse {
  int32 count = 1;
}